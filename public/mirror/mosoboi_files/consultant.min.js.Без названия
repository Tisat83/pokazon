!function(t,e){for(var n in e)t[n]=e[n]}(this,function(t){function e(a){if(n[a])return n[a].exports;var s=n[a]={exports:{},id:a,loaded:!1};return t[a].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){Comagic.UI.registerViewController("consultant",function(t,e){function n(e){var n=t.chat.is_visible&&(A.consultant_chat.isChatAvailable()||"chat"===A.consultant_chat.getState()),a=t.offline_message.is_visible&&(!t.chat.is_visible||!A.consultant_chat.isChatAvailable());return{consultant_label:function(){var t=n||a;switch(e){case"simple_sitephone":case"rack":return t;default:return!1}}(),consultant_chat_label_icon:n,rack:!0,consultant_chat_group_selector:function(){switch(e){case"consultant_chat":case"consultant_chat_group_selector":return t.chat.is_groups_enabled&&"available"===A.consultant_chat.getState()&&!C()&&!B;default:return!1}}(),consultant_chat:function(){switch(e){case"consultant_chat":return!0;default:return!1}}(),consultant_offline_message:"consultant_offline_message"===e}}function a(t){for(var e in t)t.hasOwnProperty(e)&&A[e]&&(t[e]?!A[e].isVisible()&&A[e].show():A[e].isVisible()&&A[e].hide())}function s(t){t.consultant_chat_label_icon?(A.consultant_label.getEl().classList.add("comagic-js-consultant-label--chat"),A.consultant_label.getEl().classList.remove("comagic-js-consultant-label--offline-message")):(i(),A.consultant_label.getEl().classList.add("comagic-js-consultant-label--offline-message"),A.consultant_label.getEl().classList.remove("comagic-js-consultant-label--chat"))}function c(){return A.consultant_chat.refs.log.scrollHeight>A.consultant_chat.refs.log.offsetHeight}function o(){A.consultant_chat.refs.log.scrollTop=A.consultant_chat.refs.log.scrollHeight}function i(){A.consultant_label.refs.counter.innerHTML=A.consultant_chat.getUnreadCounter()||""}function r(t){var e=Comagic.UI.getWidget(t.widgetName);return function(n){var a=t.feedbackClassName||"comagic-js-show-feedback--"+(n.success?"success":"failure");e.refs.content&&(e.refs.content.classList.add(a),n.info&&(e.refs.feedbackTitle.innerHTML=n.info.title,e.refs.feedbackMessage.innerHTML=n.info.message)),window.setTimeout(function(){t.doAfterSubmit&&t.doAfterSubmit(n),t.isClear&&e.refs.content.classList.remove(a)},3e3)}}function l(t,n){var a="comagic-js-consultant-message--hidden";return Comagic.UI.createWidget(t,{settings:n,tpl:e[t],show:function(){var t=this;setTimeout(function(){t.getEl().classList.remove(a)},1)}})}function u(e,n){return n.sender=e.sender||n.sender,n.v_position=t.chat.v_position,n.h_position=t.chat.h_position,n}function f(t){return!!t.fx_link}function g(t,e){var n="_";return f(e)&&(n+="file_"),"consultant_chat_"+e.sender+n+t.name}function _(t){var e=t.isHistoryMode,n=t;return function(t){var a,s,i=A.consultant_chat.refs.log;return t=u(n,t),s=g(n,t),a=l(s,t),a.render(i,e&&i.firstChild),e?(N.last&&N.last.settings.sender===t.sender&&a.getEl().classList.remove("comagic-js-last-message"),N.last=a):(N.first&&N.first.settings.sender===t.sender&&N.first.getEl().classList.remove("comagic-js-last-message"),N.first=a),a.show(),A.consultant_chat.isVisible()&&"operator"===t.sender&&A.consultant_chat.clearUnreadCounter(),e||c()&&o(),a}}function d(t){A.consultant_chat.refs.messageEditor.classList[t?"add":"remove"]("comagic-js-messages-editor--ready-for-send")}function h(){A.consultant_chat.getRequiredInfo().length?v(m):m()}function m(){var t=A.consultant_chat.refs.messageCreator,e=!!t&&t.innerText.trim()||"";e&&(W(A.consultant_chat.sendChatMessage(e,C())),"invite"===A.consultant_chat.getState()&&A.consultant_chat.inviteAccept()),t.innerHTML="",d(!1)}function b(){A.consultant_chat.refs.messageEditor.classList.add("comagic-js-messages-editor--disabled"),A.consultant_chat.refs.messageCreator.setAttribute("contenteditable",!1)}function p(){A.consultant_chat.refs.messageEditor.classList.remove("comagic-js-messages-editor--disabled"),A.consultant_chat.refs.messageCreator.setAttribute("contenteditable",!0)}function v(e){var n=U({chat:t.chat,sender:"bot"});B=!0,b(),n.refs.submitBtn.addEventListener("click",function(){n.getErrors()||A.consultant_chat.setVisitorCard(n.getValues(),function(){n.refs.content.classList.add("comagic-js-show-feedback"),p(),B=!1,e()})})}function L(){E(null)}function E(t){Comagic.storage.setItem("_cmg_current_group_id",t)}function C(){return Comagic.storage.getItem("_cmg_current_group_id")}function w(t,e){A.consultant_chat.refs[t].classList[e?"add":"remove"]("comagic-js-btn-hidden")}function k(t){w("ratingBtn",t)}function T(t){w("emailBtn",t)}function y(t){A.consultant_chat.refs.headerTitle.innerHTML=t}function S(t){var e=[8,13,37,38,39,40,46],n=!1;return e.indexOf(t.which)===-1&&e.indexOf(t.keyCode)===-1||(n=!0),n}function j(t,e){if(t.childNodes[0]){var n=t.childNodes[0];if(n&&n.length>=e){var a=window.document.createRange(),s=window.getSelection();a.setStart(n,e),a.collapse(!0),s.removeAllRanges(),s.addRange(a)}}}function x(){var e=t.chat.is_groups_enabled&&A.consultant_chat_group_selector.isVisible(),n=A.consultant_chat.getOperatorVcard(),a=e?t.chat.group_title:t.chat.title;return n&&"available"!==A.consultant_chat.getState()&&(a=(n.position+"<br>"+n.name).trim()),a}var I,B,H,V=function(){var n=Array.prototype.slice.call(arguments),a={do:function(e,s,c){(c||n).forEach(function(n){if("rack"===n&&"render"===e){var c=a[n].getRenderTo(),o=c.querySelector(".comagic-o-rack--"+t.chat.h_position+".comagic-o-rack--"+t.chat.v_position);if(o)return void a[n].attachEl(o)}a[n][e].apply(a[n],s)})}};return n.forEach(function(n){a[n]=Comagic.UI.createWidget(n,{isOpenWithVisibilityObserver:!0,settings:t,tpl:e[n],getHelperSelector:function(){return"comagic-js-"+this.name.replace(new RegExp("_","g"),"-")},show:function(t){var e=this;return t?(H.pub(n),!1):void setTimeout(function(){e.getEl().classList.remove(e.getHelperSelector()+"--hidden"),e.getEl().classList.add(e.getHelperSelector()+"--shown")},0)},hide:function(){this.getEl().classList.remove(this.getHelperSelector()+"--shown"),this.getEl().classList.add(this.getHelperSelector()+"--hidden")}})}),a},A=V("consultant_label","rack","consultant_chat","consultant_offline_message","consultant_chat_group_selector"),M=["rack","consultant_chat","consultant_offline_message"],O=["consultant_label"],N={last:null,first:null},R=_({name:"email_message",sender:"bot"}),U=_({name:"vcard_message",sender:"bot"}),D=_({name:"rating_message",sender:"bot"}),P=_({name:"retention_btn_message",sender:"bot"}),q=_({name:"message",isHistoryMode:!0}),W=_({name:"message"});A.do("render",null,M),A.do("render",[A.rack.getEl()],O),A.do("render",[A.consultant_chat.refs.groupSelector],["consultant_chat_group_selector"]),A.consultant_label.refs.triggerOfflineMessage.addEventListener("click",function(){H.pub("consultant_offline_message")}),A.consultant_offline_message.on("sendofflinerequest",r({widgetName:"consultant_offline_message",isClear:!0,doAfterSubmit:function(){A.consultant_offline_message.refs.submitBtn.classList.remove("comagic-js-button--disabled"),H.pub("rack")}})),A.consultant_offline_message.refs.closeBtn.addEventListener("click",function(){H.pub("rack")}),A.consultant_offline_message.refs.submitBtn.addEventListener("click",function(){A.consultant_offline_message.getErrors()||(A.consultant_offline_message.refs.submitBtn.classList.add("comagic-js-button--disabled"),A.consultant_offline_message.sendRequest(A.consultant_offline_message.getValues()))}),"available"===A.consultant_chat.getState()&&L(),t.chat.is_groups_enabled&&(A.consultant_chat_group_selector.refs.groups.forEach(function(t){t.addEventListener("click",function(t){E(t.target.dataset.groupId),H.pub("consultant_chat")})}),A.consultant_chat_group_selector.on("show",function(){T(!0),y(t.chat.group_title)}),A.consultant_chat_group_selector.on("hide",function(){T(!1),"available"===A.consultant_chat.getState()&&y(t.chat.title)})),A.consultant_label.on("show",i),A.consultant_label.refs.triggerChat.addEventListener("click",function(){H.pub("consultant_chat")}),A.consultant_chat.refs.closeBtn.addEventListener("click",function(){H.pub("rack"),"invite"===A.consultant_chat.getState()&&A.consultant_chat.inviteReject()}),A.consultant_chat.on("messageviewed",i),A.consultant_chat.on("show",function(){"available"!==A.consultant_chat.getState()&&A.consultant_chat.clearUnreadCounter(),c()&&o()}),A.consultant_chat.refs.soundBtn.addEventListener("click",function(){var t=A.consultant_chat.refs.soundBtn.classList.toggle("comagic-js-sound-btn-off");Comagic.storage.setItem("_cmg_sound_disabled",t)}),A.consultant_chat.refs.emailBtn.addEventListener("click",function(){var t=R(Comagic.UI.C.MESSAGES_SETTINGS.email);t.refs.submitBtn.addEventListener("click",function(){t.getErrors()||Comagic.sendChatByMail(t.getValues(),r({feedbackClassName:"comagic-js-show-feedback",widgetName:"consultant_chat_bot_email_message"}))})}),A.consultant_chat.refs.ratingBtn&&A.consultant_chat.refs.ratingBtn.addEventListener("click",function(){var t=D(A.consultant_chat.getOperatorVcard()||{sender:"bot"});t.refs.thumbsUpBtn.addEventListener("click",function(){A.consultant_chat.setOperatorRating(5),t.refs.content.classList.add("comagic-js-show-feedback")}),t.refs.thumbsDownBtn.addEventListener("click",function(){A.consultant_chat.setOperatorRating(1),t.refs.content.classList.add("comagic-js-show-feedback")}),k(!0)}),A.consultant_chat.refs.messageCreator.addEventListener("paste",function(t){var e,n=this,a=n.getAttribute("c-max");e=window.clipboardData?window.clipboardData.getData("Text"):t.clipboardData.getData("text/plain"),e=n.innerText+e,e>=a?n.innerText=e.slice(0,a):n.innerText=e,j(n,n.innerText.length),n.scrollTop=1e4,t.preventDefault()}),A.consultant_chat.refs.messageCreator.addEventListener("keydown",function(t){var e=this;return!t.ctrlKey&&!S(t)&&e.innerText.length>=e.getAttribute("c-max")?(t.preventDefault(),!1):(A.consultant_chat.chatTyping(e.textContent||""),void(13!==t.which&&13!==t.keyCode||t.shiftKey||(h(),t.preventDefault())))}),A.consultant_chat.refs.messageCreator.addEventListener("keyup",function(){var t=this;d(t.innerHTML.length>0)}),A.consultant_chat.refs.textPusher.addEventListener("click",h),A.consultant_chat.refs.filePusher.addEventListener("change",function(){"invite"===A.consultant_chat.getState()&&A.consultant_chat.inviteAccept(),A.consultant_chat.sendFile(this)}),A.consultant_chat.on("ratingchange",function(t){k(!!t)}),A.consultant_chat.on("chatavailabilitychange",function(){A.consultant_chat.isVisible()||A.consultant_offline_message.isVisible()||H.pub("rack")}),A.consultant_chat.on("showchatretentionaction",function(t){var e=P(Comagic.UI.C.RETENTION_BUTTONS_SETTINGS[t.alternate_communication_way]);e.refs.submitBtn.addEventListener("click",function(){A.consultant_chat.closeChat(function(){"sitephone"===t.alternate_communication_way?Comagic.openSitePhonePanel():"chat"===t.alternate_communication_way?(L(),Comagic.openChatWindow()):"offline_message"===t.alternate_communication_way&&Comagic.openSiteRequestPanel()})})}),A.consultant_chat.on("showhistory",function(t){for(var e=null;t.length;)e=t.shift(),W(e)}),A.consultant_chat.on("sendmessage",function(t){"operator"===t.sender&&(A.consultant_chat.refs.typingIndicator.classList.remove("comagic-js-is-typing"),Comagic.storage.getItem("_cmg_sound_disabled")||A.consultant_chat.refs.soundControl.play()),W(t),i()}),A.consultant_chat.on("operatorjoined",function(t,e){y(x())}),y(x()),A.consultant_chat.refs.log.addEventListener("scroll",function(t){var e,n,a,s=A.consultant_chat.refs.log;if(0===s.scrollTop&&(e=A.consultant_chat.getHistory(),a=s.scrollHeight,e)){for(n=0;n<e.length;n++)q(e[n]);s.scrollTop=s.scrollHeight-a,t.preventDefault()}}),A.consultant_chat.on("chattyping",function(){clearTimeout(I),A.consultant_chat.refs.typingIndicator.classList.add("comagic-js-is-typing"),I=setTimeout(function(){A.consultant_chat.refs.typingIndicator.classList.remove("comagic-js-is-typing")},5e3)}),A.consultant_chat.on("statechange",function(t){switch(t){case"chat":case"invite":H.pub("consultant_chat");break;default:!A.consultant_chat.isVisible()&&H.pub("rack"),y(x())}}),A.consultant_chat.on("invite",function(e){t.chat.is_visible&&"operator"===e.sender&&setTimeout(function(){H.pub("consultant_chat"),Comagic.storage.getItem("_cmg_sound_disabled")||A.consultant_chat.refs.soundControl.play(),W(e)},1)}),H=Comagic.UI.createObserver(n),H.sub(a),H.sub(s),H.pub("hide_all"),H.pub("rack"),Comagic.on("sleep",function(){H.pub("hide_all")}),setTimeout(function(){A.consultant_chat.el.classList.remove("comagic-c-consultant-container--no-transition"),A.consultant_offline_message.el.classList.remove("comagic-c-consultant-container--no-transition")},300)})}]));