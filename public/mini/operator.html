<script>
(function () {
  const DEADLINE = Date.now() + 10000;

  function norm(s){ return (s||'').toLowerCase().replace(/\s+/g,' ').trim(); }
  function text(el){ return norm(el.textContent); }

  function shrink() {
    const panel = Array.from(document.querySelectorAll('div,section,aside'))
      .find(n => /панель оператора/i.test((n.textContent||'')));
    if (!panel) { if (Date.now() < DEADLINE) requestAnimationFrame(shrink); return; }

    document.documentElement.classList.add('oko-mini-compact','oko-hide-log');

    // найдём шапку
    const header =
      Array.from(panel.querySelectorAll('div,header,h1,h2,h3'))
        .find(h => /панель оператора/i.test((h.textContent||''))) || panel;

    // убедимся, что «крестик» (закрыть) видим / справа
    const closeBtn =
      header.querySelector('button, a, .close, .oko-close') ||
      panel.querySelector('button[aria-label="Close"], [data-oko-close]');
    if (closeBtn) {
      closeBtn.style.display = '';
      closeBtn.style.marginLeft = 'auto';
    }

    // тело панели
    let body = panel.querySelector('.oko-mini-body');
    if (!body) {
      body = document.createElement('div');
      body.className = 'oko-mini-body';
      Array.from(panel.children).forEach(ch => { if (ch!==header) body.appendChild(ch); });
      panel.appendChild(body);
    }

    // поле кода + «Войти»
    const codeInput = Array.from(panel.querySelectorAll('input,textarea'))
      .find(el => /код/.test(norm(el.placeholder)));
    const joinBtn = Array.from(panel.querySelectorAll('button, a'))
      .find(el => text(el)==='войти');

    if (!codeInput || !joinBtn) {
      if (Date.now() < DEADLINE) requestAnimationFrame(shrink);
      return;
    }

    // спрятать всё лишнее
    const hideContains = [
      'только указка','синхронная прокрутка','подогнать','автоподгон','сброс',
      'окно wxh','окно w×h','якорь','перейти','pgup','pgdn','top','bottom','лог',
      'экран клиента','твой экран'     // ← добавили строки про экраны
    ];

    Array.from(body.querySelectorAll('*')).forEach(el => {
      const keep = el===codeInput || el===joinBtn ||
                   (el.contains && (el.contains(codeInput)||el.contains(joinBtn)));
      if (keep) return;

      const t = text(el);
      if (hideContains.some(key => t.includes(key))) {
        el.style.display = 'none';
        el.setAttribute('data-mini-hidden','1');
      }
    });

    // следим за перерисовками
    const mo = new MutationObserver(() => shrink());
    mo.observe(panel, { childList:true, subtree:true });
  }

  window.addEventListener('load', shrink);
  setTimeout(shrink, 400);
  setTimeout(shrink, 1000);
  setTimeout(shrink, 2000);
})();
</script>
